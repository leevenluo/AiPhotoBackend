# Google Gemini API é›†æˆé…ç½®æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

é¡¹ç›®å·²é›†æˆ Google Gemini API ç”¨äº AI å›¾åƒç”Ÿæˆã€‚æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•é…ç½®å’Œä½¿ç”¨ã€‚

## ğŸ”‘ è·å– Gemini API Key

### æ­¥éª¤ 1: è®¿é—® Google AI Studio

1. æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttps://aistudio.google.com/app/apikey
2. ä½¿ç”¨ Google è´¦å·ç™»å½•
3. ç‚¹å‡» "Create API Key" æŒ‰é’®
4. é€‰æ‹©æˆ–åˆ›å»ºä¸€ä¸ª Google Cloud é¡¹ç›®
5. å¤åˆ¶ç”Ÿæˆçš„ API Key

### æ­¥éª¤ 2: é…ç½® API Key

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# å¤åˆ¶ç¤ºä¾‹æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶
nano .env
```

æ·»åŠ ä½ çš„ API Keyï¼š

```env
GEMINI_API_KEY=AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
```

#### æ–¹å¼äºŒï¼šç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶

ç¼–è¾‘ `src/config/index.js`ï¼š

```javascript
gemini: {
  apiKey: 'your-actual-api-key-here',
  // ...
}
```

âš ï¸ **æ³¨æ„**ï¼šæ–¹å¼äºŒä¸æ¨èç”¨äºç”Ÿäº§ç¯å¢ƒï¼ŒAPI Key ä¼šè¢«æäº¤åˆ°ä»£ç åº“ã€‚

## ğŸ¨ å·¥ä½œåŸç†

### å½“å‰å®ç°é€»è¾‘

```
ç”¨æˆ·å‘èµ·ç”Ÿæˆè¯·æ±‚
    â†“
æ‰£é™¤ç§¯åˆ†ï¼Œåˆ›å»ºä»»åŠ¡
    â†“
è°ƒç”¨ Gemini API
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–¹æ¡ˆä¸€ï¼šImagen 3 å›¾åƒç”Ÿæˆï¼ˆä¸»æ–¹æ¡ˆï¼‰  â”‚
â”‚  - ä½¿ç”¨ Imagen 3.0 API               â”‚
â”‚  - åŸºäºæç¤ºè¯ç”Ÿæˆå…¨æ–°å›¾åƒ             â”‚
â”‚  - è¿”å›ç”Ÿæˆçš„å›¾ç‰‡ URL                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ (å¦‚æœå¤±è´¥)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–¹æ¡ˆäºŒï¼šGemini æ–‡æœ¬ä¼˜åŒ–ï¼ˆå›é€€æ–¹æ¡ˆï¼‰  â”‚
â”‚  - ä½¿ç”¨ Gemini ä¼˜åŒ–æç¤ºè¯             â”‚
â”‚  - ç”Ÿæˆè‰ºæœ¯æè¿°                      â”‚
â”‚  - è¿”å›åŸå›¾ + å¢å¼ºæè¿°               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ (å¦‚æœå†å¤±è´¥)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–¹æ¡ˆä¸‰ï¼šç®€å•å›é€€ï¼ˆæœ€ç»ˆæ–¹æ¡ˆï¼‰         â”‚
â”‚  - ç›´æ¥è¿”å›åŸå›¾                      â”‚
â”‚  - ä»»åŠ¡æ ‡è®°ä¸ºå®Œæˆ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¡ API è°ƒç”¨è¯´æ˜

### Gemini æ¨¡å‹é€‰æ‹©

é…ç½®æ–‡ä»¶ä¸­å¯ä»¥é€‰æ‹©ä¸åŒçš„æ¨¡å‹ï¼š

```javascript
gemini: {
  model: 'gemini-2.0-flash-exp',  // å¿«é€Ÿæ¨¡å‹
  // æˆ–
  model: 'gemini-1.5-pro',        // ä¸“ä¸šæ¨¡å‹
  // æˆ–
  model: 'gemini-1.5-flash',      // é—ªç”µæ¨¡å‹
}
```

### Imagen 3 å›¾åƒç”Ÿæˆ

Imagen 3 æ˜¯ Google çš„å›¾åƒç”Ÿæˆ APIï¼š

- **æ¨¡å‹**: `imagen-3.0-generate-001`
- **æ”¯æŒ**: æ–‡æœ¬åˆ°å›¾åƒç”Ÿæˆ
- **è´¨é‡**: é«˜è´¨é‡ã€è¯¦ç»†çš„å›¾åƒ
- **é™åˆ¶**: éœ€è¦ Google Cloud é¡¹ç›®å’Œè®¡è´¹è´¦æˆ·

## ğŸ§ª æµ‹è¯•é…ç½®

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

è¿™ä¼šå®‰è£…ï¼š
- `@google/generative-ai`: Google Gemini SDK
- `axios`: HTTP å®¢æˆ·ç«¯

### 2. å¯åŠ¨æœåŠ¡

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡å¹¶å¯åŠ¨
GEMINI_API_KEY=your-api-key npm run dev

# æˆ–è€…é…ç½® .env æ–‡ä»¶åç›´æ¥å¯åŠ¨
npm run dev
```

### 3. æµ‹è¯•ç”Ÿæˆ

ä½¿ç”¨ Postman æˆ– curlï¼š

```bash
# 1. ç™»å½•è·å– Token
curl -X POST http://localhost:3000/api/user/login \
  -H "Content-Type: application/json" \
  -d '{"code":"test_wx_code_123"}'

# 2. ç”Ÿæˆå›¾ç‰‡
curl -X POST http://localhost:3000/api/photo/generate \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "photoUrl": "https://images.pexels.com/photos/417074/pexels-photo-417074.jpeg",
    "prompt": "transform this into a magical fantasy scene with glowing lights"
  }'

# 3. æŸ¥è¯¢çŠ¶æ€
curl -X GET "http://localhost:3000/api/photo/status?taskId=TASK_ID" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## ğŸ”§ é«˜çº§é…ç½®

### è‡ªå®šä¹‰ç”Ÿæˆå‚æ•°

ç¼–è¾‘ `src/controllers/photoController.js` ä¸­çš„ `_generateWithImagen` æ–¹æ³•ï¼š

```javascript
{
  instances: [
    {
      prompt: enhancedPrompt,
      sampleCount: 1,           // ç”Ÿæˆæ•°é‡
      aspectRatio: '1:1',       // å®½é«˜æ¯”: '1:1', '16:9', '9:16', '4:3'
      negativePrompt: '...',    // è´Ÿé¢æç¤ºè¯
      personGeneration: 'allow_adult',  // äººç‰©ç”Ÿæˆç­–ç•¥
      // å…¶ä»–å‚æ•°...
    }
  ]
}
```

### è°ƒæ•´è¶…æ—¶æ—¶é—´

```javascript
{
  timeout: 60000  // 60ç§’ï¼Œæ ¹æ®éœ€è¦è°ƒæ•´
}
```

### å›¾ç‰‡ä¿å­˜ç­–ç•¥

å½“å‰æ”¯æŒï¼š
1. **ä¿å­˜åˆ°æœ¬åœ°**: base64 è½¬æ¢å¹¶ä¿å­˜åˆ° `uploads/` ç›®å½•
2. **ä½¿ç”¨ URL**: ç›´æ¥ä½¿ç”¨ API è¿”å›çš„å›¾ç‰‡ URL
3. **ä¸Šä¼ åˆ° CDN**: å¯æ‰©å±•ä¸Šä¼ åˆ°äº‘å­˜å‚¨

## âš ï¸ é‡è¦è¯´æ˜

### API é™åˆ¶

1. **å…è´¹é…é¢**:
   - Gemini API æœ‰å…è´¹é…é¢é™åˆ¶
   - æŸ¥çœ‹ï¼šhttps://ai.google.dev/pricing

2. **Imagen 3 è®¡è´¹**:
   - Imagen 3 å›¾åƒç”Ÿæˆéœ€è¦ä»˜è´¹
   - éœ€è¦åœ¨ Google Cloud å¯ç”¨è®¡è´¹

3. **è¯·æ±‚é™åˆ¶**:
   - æ¯åˆ†é’Ÿè¯·æ±‚æ¬¡æ•°é™åˆ¶
   - éœ€è¦å®ç°è¯·æ±‚é˜Ÿåˆ—æˆ–é™æµ

### é”™è¯¯å¤„ç†

ä»£ç å·²å®ç°ä¸‰å±‚å›é€€æœºåˆ¶ï¼š
1. ä¸»æ–¹æ¡ˆå¤±è´¥ â†’ å›é€€åˆ°æ–¹æ¡ˆäºŒ
2. æ–¹æ¡ˆäºŒå¤±è´¥ â†’ å›é€€åˆ°æ–¹æ¡ˆä¸‰
3. ç¡®ä¿ä»»åŠ¡æ€»èƒ½å®Œæˆ

### ç”Ÿäº§ç¯å¢ƒå»ºè®®

1. **å®ç°è¯·æ±‚é˜Ÿåˆ—**
   ```bash
   npm install bull redis
   ```

2. **æ·»åŠ é‡è¯•æœºåˆ¶**
   ```javascript
   const retry = require('async-retry');
   ```

3. **ç›‘æ§å’Œæ—¥å¿—**
   ```bash
   npm install winston
   ```

4. **æˆæœ¬æ§åˆ¶**
   - å®ç°ç§¯åˆ†ç³»ç»Ÿ
   - é™åˆ¶æ¯æ—¥ç”Ÿæˆæ¬¡æ•°
   - ç¼“å­˜å¸¸è§ç»“æœ

## ğŸ“š å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£
- [Google AI Studio](https://aistudio.google.com/)
- [Gemini API æ–‡æ¡£](https://ai.google.dev/docs)
- [Imagen 3 æ–‡æ¡£](https://cloud.google.com/vertex-ai/docs/generative-ai/image/overview)
- [API å®šä»·](https://ai.google.dev/pricing)

### ç¤ºä¾‹ä»£ç 
- [Gemini Node.js å¿«é€Ÿå¼€å§‹](https://ai.google.dev/tutorials/node_quickstart)
- [å›¾åƒç”Ÿæˆç¤ºä¾‹](https://ai.google.dev/tutorials/image_generation)

## ğŸ› æ•…éšœæ’é™¤

### API Key æ— æ•ˆ

```
Error: API key not valid
```

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ API Key æ˜¯å¦æ­£ç¡®å¤åˆ¶
2. ç¡®è®¤ API Key æ²¡æœ‰è¿‡æœŸ
3. åœ¨ Google AI Studio é‡æ–°ç”Ÿæˆ

### Imagen API 403 é”™è¯¯

```
Error: 403 Forbidden
```

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤å·²å¯ç”¨ Vertex AI API
2. æ£€æŸ¥ Google Cloud é¡¹ç›®è®¡è´¹çŠ¶æ€
3. éªŒè¯ API Key æƒé™

### è¶…æ—¶é”™è¯¯

```
Error: timeout of 60000ms exceeded
```

**è§£å†³æ–¹æ¡ˆ**:
1. å¢åŠ è¶…æ—¶æ—¶é—´
2. æ£€æŸ¥ç½‘ç»œè¿æ¥
3. ç®€åŒ–æç¤ºè¯

### ä¾èµ–å®‰è£…å¤±è´¥

```
Error: Cannot find module '@google/generative-ai'
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
npm install @google/generative-ai axios --save
```

## ğŸ¯ ä¸‹ä¸€æ­¥

1. âœ… å®‰è£…ä¾èµ–
2. âœ… è·å–å¹¶é…ç½® API Key
3. âœ… æµ‹è¯•ç”ŸæˆåŠŸèƒ½
4. ğŸ”„ æ ¹æ®éœ€è¦è°ƒæ•´å‚æ•°
5. ğŸš€ éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

---

**æç¤º**: å¦‚æœæš‚æ—¶æ²¡æœ‰ Gemini API Keyï¼Œä»£ç ä¼šè‡ªåŠ¨å›é€€åˆ°æ¨¡æ‹Ÿæ¨¡å¼ï¼Œä¸å½±å“å…¶ä»–åŠŸèƒ½æµ‹è¯•ã€‚
